<html>
  <head>
    <title>Survivor Draft Inputs - A True Commishportunity</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"></link>
  </head>
  <body>
    <div class="row">
      <div class="col-sm-12 col-md-6 col-lg-3">
        <label>JDM</label>
        <div id="Justis">
          <input></input><button class="submit">Submit</button>
          <br />
          <button class="plus" add-val="1">+1</button>
          <button class="plus" add-val="3">+3</button>
          <button class="plus" add-val="5">+5</button>
          <button class="plus" add-val="6">+6</button>
          <button class="plus" add-val="10">+10</button>
          <button class="plus" add-val="20">+20</button>
        </div>
      </div>

      <div class="col-sm-12 col-md-6 col-lg-3">
        <label>MAX</label>
        <div id="Max">
          <input></input><button class="submit">Submit</button>
          <br />
          <button class="plus" add-val="1">+1</button>
          <button class="plus" add-val="3">+3</button>
          <button class="plus" add-val="5">+5</button>
          <button class="plus" add-val="6">+6</button>
          <button class="plus" add-val="10">+10</button>
          <button class="plus" add-val="20">+20</button>
        </div>
      </div>

      <div class="col-sm-12 col-md-6 col-lg-3">
        <label>MSN</label>
        <div id="Marshawn">
          <input></input><button class="submit">Submit</button>
          <br />
          <button class="plus" add-val="1">+1</button>
          <button class="plus" add-val="3">+3</button>
          <button class="plus" add-val="5">+5</button>
          <button class="plus" add-val="6">+6</button>
          <button class="plus" add-val="10">+10</button>
          <button class="plus" add-val="20">+20</button>
        </div>
      </div>

      <div class="col-sm-12 col-md-6 col-lg-3">
        <label>MF</label>
        <div id="Alec">
          <input></input><button class="submit">Submit</button>
          <br />
          <button class="plus" add-val="1">+1</button>
          <button class="plus" add-val="3">+3</button>
          <button class="plus" add-val="5">+5</button>
          <button class="plus" add-val="6">+6</button>
          <button class="plus" add-val="10">+10</button>
          <button class="plus" add-val="20">+20</button>
        </div>
      </div>
    </div>

    <br />

    <div class="row">
      <div class="col-sm-12 col-md-6 col-lg-3">
        <div class="playerPartition">
          <label></label>
          <br />
          <input></input><button class="submit">Submit</button>
          <br />
          <button class="plus" add-val="1">+1</button>
          <button class="plus" add-val="3">+3</button>
          <button class="plus" add-val="5">+5</button>
          <button class="plus" add-val="6">+6</button>
          <button class="plus" add-val="10">+10</button>
          <button class="plus" add-val="20">+20</button>
        </div>
        <div class="playerPartition">
          <label></label>
          <br />
          <input></input><button class="submit">Submit</button>
          <br />
          <button class="plus" add-val="1">+1</button>
          <button class="plus" add-val="3">+3</button>
          <button class="plus" add-val="5">+5</button>
          <button class="plus" add-val="6">+6</button>
          <button class="plus" add-val="10">+10</button>
          <button class="plus" add-val="20">+20</button></div>
        <div class="playerPartition">
          <label></label>
          <br />
          <input></input><button class="submit">Submit</button>
          <br />
          <button class="plus" add-val="1">+1</button>
          <button class="plus" add-val="3">+3</button>
          <button class="plus" add-val="5">+5</button>
          <button class="plus" add-val="6">+6</button>
          <button class="plus" add-val="10">+10</button>
          <button class="plus" add-val="20">+20</button></div>
        <div class="playerPartition">
          <label></label>
          <br />
          <input></input><button class="submit">Submit</button>
          <br />
          <button class="plus" add-val="1">+1</button>
          <button class="plus" add-val="3">+3</button>
          <button class="plus" add-val="5">+5</button>
          <button class="plus" add-val="6">+6</button>
          <button class="plus" add-val="10">+10</button>
          <button class="plus" add-val="20">+20</button></div>
        <div class="playerPartition">
          <label></label>
          <br />
          <input></input><button class="submit">Submit</button>
          <br />
          <button class="plus" add-val="1">+1</button>
          <button class="plus" add-val="3">+3</button>
          <button class="plus" add-val="5">+5</button>
          <button class="plus" add-val="6">+6</button>
          <button class="plus" add-val="10">+10</button>
          <button class="plus" add-val="20">+20</button></div>
        </div>
        <div class="col-sm-12 col-md-6 col-lg-3">
        <div class="playerPartition">
          <label></label>
          <br />
          <input></input><button class="submit">Submit</button>
          <br />
          <button class="plus" add-val="1">+1</button>
          <button class="plus" add-val="3">+3</button>
          <button class="plus" add-val="5">+5</button>
          <button class="plus" add-val="6">+6</button>
          <button class="plus" add-val="10">+10</button>
          <button class="plus" add-val="20">+20</button></div>
          <div class="playerPartition">
          <label></label>
          <br />
          <input></input><button class="submit">Submit</button>
          <br />
          <button class="plus" add-val="1">+1</button>
          <button class="plus" add-val="3">+3</button>
          <button class="plus" add-val="5">+5</button>
          <button class="plus" add-val="6">+6</button>
          <button class="plus" add-val="10">+10</button>
          <button class="plus" add-val="20">+20</button></div>
        <div class="playerPartition">
          <label></label>
          <br />
          <input></input><button class="submit">Submit</button>
          <br />
          <button class="plus" add-val="1">+1</button>
          <button class="plus" add-val="3">+3</button>
          <button class="plus" add-val="5">+5</button>
          <button class="plus" add-val="6">+6</button>
          <button class="plus" add-val="10">+10</button>
          <button class="plus" add-val="20">+20</button></div>
        <div class="playerPartition">
          <label></label>
          <br />
          <input></input><button class="submit">Submit</button>
          <br />
          <button class="plus" add-val="1">+1</button>
          <button class="plus" add-val="3">+3</button>
          <button class="plus" add-val="5">+5</button>
          <button class="plus" add-val="6">+6</button>
          <button class="plus" add-val="10">+10</button>
          <button class="plus" add-val="20">+20</button></div>
        <div class="playerPartition">
          <label></label>
          <br />
          <input></input><button class="submit">Submit</button>
          <br />
          <button class="plus" add-val="1">+1</button>
          <button class="plus" add-val="3">+3</button>
          <button class="plus" add-val="5">+5</button>
          <button class="plus" add-val="6">+6</button>
          <button class="plus" add-val="10">+10</button>
          <button class="plus" add-val="20">+20</button></div>
        </div>
      <div class="col-sm-12 col-md-6 col-lg-3">
        <div class="playerPartition">
          <label></label>
          <br />
          <input></input><button class="submit">Submit</button>
          <br />
          <button class="plus" add-val="1">+1</button>
          <button class="plus" add-val="3">+3</button>
          <button class="plus" add-val="5">+5</button>
          <button class="plus" add-val="6">+6</button>
          <button class="plus" add-val="10">+10</button>
          <button class="plus" add-val="20">+20</button></div>
        <div class="playerPartition">
          <label></label>
          <br />
          <input></input><button class="submit">Submit</button>
          <br />
          <button class="plus" add-val="1">+1</button>
          <button class="plus" add-val="3">+3</button>
          <button class="plus" add-val="5">+5</button>
          <button class="plus" add-val="6">+6</button>
          <button class="plus" add-val="10">+10</button>
          <button class="plus" add-val="20">+20</button></div>
        <div class="playerPartition">
          <label></label>
          <br />
          <input></input><button class="submit">Submit</button>
          <br />
          <button class="plus" add-val="1">+1</button>
          <button class="plus" add-val="3">+3</button>
          <button class="plus" add-val="5">+5</button>
          <button class="plus" add-val="6">+6</button>
          <button class="plus" add-val="10">+10</button>
          <button class="plus" add-val="20">+20</button></div>
        <div class="playerPartition">
          <label></label>
          <br />
          <input></input><button class="submit">Submit</button>
          <br />
          <button class="plus" add-val="1">+1</button>
          <button class="plus" add-val="3">+3</button>
          <button class="plus" add-val="5">+5</button>
          <button class="plus" add-val="6">+6</button>
          <button class="plus" add-val="10">+10</button>
          <button class="plus" add-val="20">+20</button></div>
        <div class="playerPartition">
          <label></label>
          <br />
          <input></input><button class="submit">Submit</button>
          <br />
          <button class="plus" add-val="1">+1</button>
          <button class="plus" add-val="3">+3</button>
          <button class="plus" add-val="5">+5</button>
          <button class="plus" add-val="6">+6</button>
          <button class="plus" add-val="10">+10</button>
          <button class="plus" add-val="20">+20</button></div>
        </div>
        <div class="col-sm-12 col-md-6 col-lg-3">
        <div class="playerPartition">
          <label></label>
          <br />
          <input></input><button class="submit">Submit</button>
          <br />
          <button class="plus" add-val="1">+1</button>
          <button class="plus" add-val="3">+3</button>
          <button class="plus" add-val="5">+5</button>
          <button class="plus" add-val="6">+6</button>
          <button class="plus" add-val="10">+10</button>
          <button class="plus" add-val="20">+20</button></div>
      <div class="playerPartition">
        <label></label>
        <br />
        <input></input><button class="submit">Submit</button>
        <br />
        <button class="plus" add-val="1">+1</button>
        <button class="plus" add-val="3">+3</button>
        <button class="plus" add-val="5">+5</button>
        <button class="plus" add-val="6">+6</button>
        <button class="plus" add-val="10">+10</button>
        <button class="plus" add-val="20">+20</button></div>
      <div class="playerPartition">
        <label></label>
        <br />
        <input></input><button class="submit">Submit</button>
        <br />
        <button class="plus" add-val="1">+1</button>
        <button class="plus" add-val="3">+3</button>
        <button class="plus" add-val="5">+5</button>
        <button class="plus" add-val="6">+6</button>
        <button class="plus" add-val="10">+10</button>
        <button class="plus" add-val="20">+20</button></div>
      <div class="playerPartition">
        <label></label>
        <br />
        <input></input><button class="submit">Submit</button>
        <br />
        <button class="plus" add-val="1">+1</button>
        <button class="plus" add-val="3">+3</button>
        <button class="plus" add-val="5">+5</button>
        <button class="plus" add-val="6">+6</button>
        <button class="plus" add-val="10">+10</button>
        <button class="plus" add-val="20">+20</button></div>
      <div class="playerPartition">
        <label></label>
        <br />
        <input></input><button class="submit">Submit</button>
        <br />
        <button class="plus" add-val="1">+1</button>
        <button class="plus" add-val="3">+3</button>
        <button class="plus" add-val="5">+5</button>
        <button class="plus" add-val="6">+6</button>
        <button class="plus" add-val="10">+10</button>
        <button class="plus" add-val="20">+20</button></div>
      </div>
    </div>
  </body>
</html>

<script>
  $(document).ready(function() {
    $(".submit").on("click", function(){
      if (!isNaN($($(this).siblings("input")[0]).val())) {
        updateScore($(this).parent().attr("id"), $($(this).siblings("input")[0]).val());
      }
    });

    $(".plus").on("click", function() {
      var playerNameString = $(this).parent().attr("id");
      updateScore(playerNameString, scores[playerNameString] * 1 + $(this).attr("add-val") * 1);
    });

    $.get("/getAllPlayerData", function(data) {
      players = JSON.parse(data);

      players.sort(function(a, b) {
        if (a.drafterName < b.drafterName) {
          return -1;
        }
        else {
          return 1;
          }
        });

      // add players to score tracking for button presses
      for (let player in players) {
        scores[players[player].name] = players[player].score;
      }

      createPlayerControls(players);
    });

    function createPlayerControls(players) {
      var playerPartitions = $(".playerPartition");
      for (var i = 0; i < players.length; i++) {
        var partition = $(playerPartitions[i]);
        $(partition.children("label")[0]).html(players[i].name);
        $(partition.children("input")[0]).val(players[i].score);
        partition.attr("id", players[i].name);
      }
    }
  });
</script>

<script>
  var scores = {
    Justis: 0,
    Alec: 0,
    Marshawn: 0,
    Max: 0,
  }

  var players = [];

  var HOST = location.origin.replace(/^http/, 'ws')
  var ws = new WebSocket(HOST);

  ws.onmessage = function (event) {
    var splitData = event.data.split(":");
    var name = splitData[0];
    var score = splitData[1];
    if (name === "Justis") {
      scores.Justis = score;
      $("#Justis input").val(score);
    } else if (name === "Alec") {
      scores.Alec = score;
      $("#Alec input").val(score);
    } else if (name === "Marshawn") {
      scores.Marshawn = score;
      $("#Marshawn input").val(score);
    } else if (name === "Max") {
      scores.Max = score;
      $("#Max input").val(score);
    } else {
      // it's a player
      for (let player in players) {
        if (players[player].name === name) {
          scores[players[player].name] = score;
          players[player].score = score;
          console.log(players[player].name + "'s score set to " + score);

          // IDs are not indexed through jquery so we need to brute force search to update
          var playerPartitions = $(".playerPartition");
          for (var i = 0; i < playerPartitions.length; i++) {
            if ($(playerPartitions[i]).attr("id") === name) {
              $($(playerPartitions[i]).children("input")[0]).val(score);
            }
          }
        }
      }
    }
  };

  function updateScore(person, score) {
    // Placeholder - set this with checkbox eventually.
    var updateDrafterOnUpdatePlayer = true;
    ws.send(person + ":" + score);

    if(updateDrafterOnUpdatePlayer) {
      for (var i = 0; i < players.length; i++) {
        if (players[i].name === person) {
          var drafter = players[i].drafterName;
          var scoreDifference = score - players[i].score * 1;
          ws.send(drafter + ":" + (scores[drafter] * 1 + scoreDifference * 1));
        }
      }
    }
  }
</script>
